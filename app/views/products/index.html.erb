<div class="container py-4">

  <h1 class="mb-4">Products</h1>

  <!-- Search + Filter -->
  <div class="card p-3 mb-4 shadow-sm">
    <%= form_with url: products_path, method: :get, local: true do %>
      <div class="row">

        <div class="col-md-6 mb-2">
          <%= text_field_tag :search, params[:search], placeholder: "Search productsâ€¦", class: "form-control" %>
        </div>

        <div class="col-md-4 mb-2">
          <%= select_tag :category_id,
                options_from_collection_for_select(@categories, :id, :name, params[:category_id]),
                include_blank: "All Categories",
                class: "form-control" %>
        </div>

        <div class="col-md-2 mb-2">
          <%= submit_tag "Filter", class: "btn btn-primary btn-block" %>
        </div>

      </div>
    <% end %>
  </div>

  <!-- Products Grid -->
  <div class="row">

    <% @products.each do |product| %>
      <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm">

          <!-- Product Image -->
          <% if product.images.attached? %>
            <%= image_tag product.images.first,
              class: "card-img-top",
              style: "height: 240px; object-fit: cover;" %>
          <% else %>
            <div class="bg-light d-flex justify-content-center align-items-center"
                 style="height: 240px;">
              No Image
            </div>
          <% end %>

          <div class="card-body">

            <!-- Badges -->
            <div class="mb-2">
              <% if product.is_new %>
                <span class="badge badge-success">NEW</span>
              <% end %>
              <% if product.is_on_sale %>
                <span class="badge badge-danger">SALE</span>
              <% end %>
            </div>

            <!-- Name -->
            <h5 class="card-title text-truncate"><%= product.name %></h5>

            <!-- Price -->
            <p class="card-text font-weight-bold">$<%= product.price %></p>

            <!-- Categories -->
            <p class="text-muted small">
              <%= product.categories.map(&:name).join(", ") %>
            </p>

           <%= link_to "View Details", product_path(product), class: "btn btn-primary w-100" %>


            <%= button_to "Add to Cart",
                  add_cart_path(product),
                  method: :post,
                  class: "btn btn-success btn-block mt-2" %>


          </div>
        </div>
      </div>
    <% end %>

  </div>

  <!-- Pagination -->
  <div class="mt-4 text-center">
    <%= paginate @products %>