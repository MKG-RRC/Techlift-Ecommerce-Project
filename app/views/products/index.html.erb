<div class="container py-4">

  <!-- Breadcrumbs -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb bg-white px-0 mb-0">
      <li class="breadcrumb-item"><%= link_to "Home", root_path %></li>
      <li class="breadcrumb-item active" aria-current="page">
        Products
        <% if params[:category_id].present? %>
          <span class="text-muted">/ <%= @categories.find { |c| c.id.to_s == params[:category_id].to_s }&.name %></span>
        <% end %>
      </li>
    </ol>
  </nav>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="mb-0">Products</h1>
    <%= link_to "Back to Home", root_path, class: "btn btn-outline-secondary btn-sm" %>
  </div>

  <!-- Search + Filter -->
  <div class="card p-3 mb-4 shadow-sm">
    <%= form_with url: products_path, method: :get, local: true do %>
      <div class="row">

        <div class="col-md-6 mb-2">
          <%= text_field_tag :search, params[:search], placeholder: "Search productsâ€¦", class: "form-control" %>
        </div>

        <div class="col-md-4 mb-2">
          <%= select_tag :category_id,
                options_from_collection_for_select(@categories, :id, :name, params[:category_id]),
                include_blank: "All Categories",
                class: "form-control" %>
        </div>

        <div class="col-md-2 mb-2 d-flex">
          <%= hidden_field_tag :filter, params[:filter] if params[:filter].present? %>
          <%= submit_tag "Filter", class: "btn btn-primary btn-block w-100" %>
        </div>

      </div>
    <% end %>

    <div class="d-flex flex-wrap mt-2">
      <%= link_to "All", products_path(params.permit(:search, :category_id).merge(filter: nil)), class: "btn btn-sm mr-2 mb-2 #{params[:filter].blank? ? 'btn-primary' : 'btn-outline-primary'}" %>
      <%= link_to "Sale items", products_path(params.permit(:search, :category_id).merge(filter: 'sale')), class: "btn btn-sm mr-2 mb-2 #{params[:filter] == 'sale' ? 'btn-primary' : 'btn-outline-primary'}" %>
      <%= link_to "Recently added", products_path(params.permit(:search, :category_id).merge(filter: 'new')), class: "btn btn-sm mr-2 mb-2 #{params[:filter] == 'new' ? 'btn-primary' : 'btn-outline-primary'}" %>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="row">

    <% @products.each do |product| %>
      <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm">

          <!-- Product Image -->
          <% if product.images.attached? %>
            <%= image_tag product.images.first,
              class: "card-img-top",
              style: "height: 240px; object-fit: cover;" %>
          <% else %>
            <div class="bg-light d-flex justify-content-center align-items-center"
                 style="height: 240px;">
              No Image
            </div>
          <% end %>

          <div class="card-body">

            <!-- Badges -->
            <div class="mb-2">
              <% if product.is_new %>
                <span class="badge badge-success">NEW</span>
              <% end %>
              <% if product.is_on_sale %>
                <span class="badge badge-danger">SALE</span>
              <% end %>
            </div>

            <!-- Name -->
            <h5 class="card-title text-truncate"><%= product.name %></h5>

            <!-- Price -->
            <p class="card-text font-weight-bold">$<%= product.price %></p>

            <!-- Categories -->
            <p class="text-muted small">
              <%= product.categories.map(&:name).join(", ") %>
            </p>

           <%= link_to "View Details", product_path(product), class: "btn btn-primary w-100" %>


            <%= button_to "Add to Cart",
                  add_cart_path(product),
                  method: :post,
                  class: "btn btn-success btn-block mt-2" %>


          </div>
        </div>
      </div>
    <% end %>

  </div>

  <!-- Pagination -->
  <div class="mt-4 text-center">
    <%= paginate @products %>
